<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVJourney-home</title>
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="notifica.css">
    <link rel="stylesheet" href="style_secundarios.css">
    <link rel="stylesheet" href="estilo_btn.css">
    <link rel="shortcut icon" href="img/logo_2_png.png" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

    <style>
        @media(min-width:1144px){
            #tela-loading-traducao{
                z-index: 999999999999999999999999999999999999999999999999999999999999999999999;
            }
        }
    </style>
</head>

<body>
    <div id="cima_3">
        <div id="welcome">
            <img src="img/logo_4.png" alt="" id="dono_logo">
            <h2>
                <nav>Bem vindo ao </nav><mark>CVJourney</mark>
            </h2>
        </div>

        <div id="pesquisa_">
            <input type="search" name="" id="pesquisa" placeholder="Busque por um lugar">
            <div id="tela_sol_lua">
                <span class="material-icons" id="t_restaurante">local_dining</span>
                <span class="material-icons" id="sol">account_circle</span>
            </div>
            <div id="temas_pes"></div>

        </div>
        <div id="meuCarrossel" class="carrossel">
            <div class="slides">
                <img src="img/im1.jpg" class="ativo">
                <img src="img/im2.jpg">
                <img src="img/im3.jpg">
                <img src="img/im5.jpeg">
            </div>
            <div class="indicadores">
                <span class="ativo"></span>
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="msg_pc">
            <p>
                O CVJourney √© o seu portal para explorar as maravilhas de Cabo Verde. <br>
                Encontre as melhores op√ß√µes de reserva de apartamentos, com conforto e praticidade. <br>
                <br>
                Oferecemos tamb√©m visitas guiadas exclusivas, para descobrir a cultura, a hist√≥ria e a beleza natural
                das ilhas. <br>
                <br>
                E para a sua mobilidade, o CVJourney conecta voc√™ a t√°xis dispon√≠veis, levando-o aonde quiser com
                rapidez, seguran√ßa e comodidade. <br>
                <br>
                üöÄ Em breve: nosso aplicativo oficial, trazendo tudo isso na palma da sua m√£o!
            </p>
        </div>

        <div id="campos_">
            <li onclick="manda()">Gostos</li>
        </div>
    </div>

    <div id="estadia">
        <div class="titulos_">
            <h3 id="titulo_estadia">Procure a sua estadia aqui</h3>
        </div>


    </div>

    <div id="destaque">
        <div class="titulos_">
            <h4 id="titulo_destaque">Veja locais para ir em cabo verde</h4>
        </div>

    </div>

    <h3 id="titulo_x">
        Descubra locais incr√≠veis por categoria
    </h3>

    <div id="usuario_data">
        <div id="sai_">
            <h5 id="sai">X</h5>
        </div>
        <div id="usuario_">
            <div>
                <img src="" alt="" id="usu_img">
            </div>
            <div>
                <h3>Nome</h3>
                <h4 id="usu_nome">nome...</h4>
            </div>
            <div>
                <h3>Usuario</h3>
                <h4 id="usu_username">username...</h4>
            </div>
            <div>
                <h3>Senha</h3>
                <h4 id="usu_senha">senha...</h4>
            </div>
            <div>
                <h3>Pontos</h3>
                <h4 id="usu_pontos">pontos...</h4>
            </div>
            <div>
                <button id="logout">Terminar Sess√£o</button>
            </div>
        </div>
    </div>
    <div id="container_new"></div>
    <nav id="sound" style="display: none;"></nav>

    <nav style="height: 100px;"></nav>




    <footer class="fundo-fixado">
        <div id="temas_">
            <i class="material-icons baixo" id="t_mapa">public</i>
            <i class="material-icons baixo" id="t_game">sports_esports</i>
            <i class="material-icons baixo principal" id="t_home">home</i>
            <i class="material-icons baixo" id="t_taxi">local_taxi</i>
            <i class="material-icons baixo" id="t_mail">mail</i>
        </div>
    </footer>

    <script src="script_tradutor.js"></script>
    <script src="script_cria_campos.js"></script>
    <script src="script_troca.js"></script>
    <script src="script_secundarios.js"></script>
    <script src="script_pesquisa.js"></script>
    <script src="traduzir.js"></script>
    <script src="script_noti.js"></script>
    <script src="script_noti_in.js"></script>

    <script>
        // ---------- Firebase ----------
        const firebaseConfig = {
            databaseURL: "https://subscription-41d39-default-rtdb.europe-west1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ---------- Service Worker ----------
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('script_noti.js')
                .then(() => console.log("Service Worker registrado!"))
                .catch(err => console.error("Erro ao registrar SW:", err));
        }

        // ---------- Permiss√£o de Notifica√ß√£o ----------
        async function pedirPermissaoNotificacao() {
            if (!("Notification" in window)) throw "Navegador n√£o suporta notifica√ß√µes.";
            if (Notification.permission === "granted") return "Permiss√£o j√° concedida.";
            if (Notification.permission === "denied") throw "Permiss√£o negada anteriormente.";

            const permission = await Notification.requestPermission();
            if (permission === "granted") return "Permiss√£o concedida!";
            throw "Permiss√£o n√£o concedida.";
        }

        // ---------- Criar e salvar subscription ----------
        async function salvarSubscription() {
            if (!('serviceWorker' in navigator) || !('PushManager' in window)) return;

            const swReg = await navigator.serviceWorker.ready;
            const subscription = await swReg.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: urlBase64ToUint8Array(
                    "BGp2boq4FE1QyAXEA_SQxBqqXdCdakzpPmOmfo2MpxycWjDSs2LGzi6TSVrTrp4LnkwDvrm8tPqRaCatvKoKTBw"
                )
            });

            // Transformar em JSON
            const subJSON = subscription.toJSON();
            const endpoint = subJSON.endpoint;

            // Checar se j√° existe no Firebase
            const snapshot = await db.ref("subscriptions").orderByChild("endpoint").equalTo(endpoint).once("value");
            if (snapshot.exists()) {
                console.log("Subscription j√° existe no Firebase:", endpoint);
                return;
            }

            // Salvar apenas se n√£o existir
            await db.ref("subscriptions").push(subJSON);
            console.log("Subscription salva no Firebase:", endpoint);
        }

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            return Uint8Array.from([...rawData].map(c => c.charCodeAt(0)));
        }

        // ---------- Inicializa√ß√£o ----------
        pedirPermissaoNotificacao()
            .then(() => salvarSubscription())
            .then(msg => console.log(msg))
            .catch(err => console.log(err));

        // ---------- Sincroniza√ß√£o com SW ----------
        function registrarSync() {
            navigator.serviceWorker.ready.then(reg => {
                reg.sync.register("verificar-reservas")
                    .then(() => console.log("Sync registrado!"))
                    .catch(err => console.error("Erro no sync:", err));
            });
        }


        // ---------- Fun√ß√£o scroll ----------
        function manda() {
            const item = document.getElementById("titulo_destaque");
            item.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        // ---------- Carrossel ----------
        (function () {
            const carrossel = document.getElementById("meuCarrossel");
            const slides = carrossel.querySelectorAll("img");
            const indicadores = carrossel.querySelectorAll(".indicadores span");

            let index = 0;
            let intervalo = 3000;
            let timer;

            function mostrarSlide(i) {
                slides.forEach(s => s.classList.remove("ativo"));
                indicadores.forEach(d => d.classList.remove("ativo"));
                slides[i].classList.add("ativo");
                indicadores[i].classList.add("ativo");
            }

            function proximo() {
                index = (index + 1) % slides.length;
                mostrarSlide(index);
            }

            function iniciar(intervaloAtual = intervalo) {
                clearInterval(timer);
                timer = setInterval(proximo, intervaloAtual);
            }

            indicadores.forEach((dot, i) => {
                dot.addEventListener("click", () => {
                    index = i;
                    mostrarSlide(index);
                    iniciar(6000); // pausa 6s se clicar no indicador
                });
            });

            mostrarSlide(index);
            iniciar();
        })();
    </script>

</body>

</html>