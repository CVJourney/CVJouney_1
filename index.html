<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style_tradutor.css">
    <title>CVJourney</title>
</head>
<body>
    <div id="centra">
        <h3 id="titulo_esc">Escolha seu idioma</h3>
        <select name="idioma_name" id="idioma">
            <option value="pt">ğŸ‡µğŸ‡¹ PortuguÃªs</option>
            <option value="en">ğŸ‡¬ğŸ‡§ English</option>
            <option value="ro">ğŸ‡·ğŸ‡´ RomÃ¢nÄƒ</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="nl">ğŸ‡³ğŸ‡± Nederlands</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
        </select>
        <h4>
            esse idioma sera utilizado no inicio da sua jornada, <br> mas podes troca-la.
        </h4>
        <button id="avanca">AvanÃ§ar</button>
    </div>

    <script>

        document.getElementById("avanca").addEventListener("click", () => {
            let select = document.getElementById("idioma").value;
            console.log(select);

            const request = indexedDB.open("idiomas", 1);

            request.onupgradeneeded = function(event) {
                const db = event.target.result;

                if (!db.objectStoreNames.contains("usuarios")) {
                    db.createObjectStore("usuarios", { keyPath: "id", autoIncrement: true });
                }
            };

            request.onsuccess = function(event) {
                const db = event.target.result;

                const tx = db.transaction("usuarios", "readwrite");
                const store = tx.objectStore("usuarios");

                // ğŸ‘‰ Limpar os dados antigos
                const clearRequest = store.clear();

                clearRequest.onsuccess = () => {
                    console.log("Dados antigos apagados.");

                    // ğŸ‘‰ Adicionar novo idioma
                    const usuario = { idioma: select };
                    const addRequest = store.add(usuario);

                    addRequest.onsuccess = () => console.log("Idioma escolhido com sucesso.");
                    addRequest.onerror = () => console.error("Erro ao adicionar o idioma.");
                };

                clearRequest.onerror = () => {
                    console.error("Erro ao limpar dados antigos.");
                };
            };

            request.onerror = function(event) {
                console.error("Erro ao abrir o banco:", event.target.error);
            };

            window.location.href="login.html"

        });
    </script>
    <script src="script_entrada.js"></script>
</body>
</html>